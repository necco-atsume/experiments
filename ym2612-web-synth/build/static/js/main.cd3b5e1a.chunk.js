(this.webpackJsonpyam2612=this.webpackJsonpyam2612||[]).push([[0],{72:function(t,e,s){},73:function(t,e,s){},78:function(t,e,s){"use strict";s.r(e);var i=s(2),n=s(0),h=s.n(n),r=s(60),o=s.n(r),a=(s(72),s(4)),c=s(98),u=s(95),l=s(94),d=s(96),f=s(97),p=(s(73),{fms:0,ams:0,fb:4,alg:0,operators:{one:{tl:25,am:!1,a:31,d:7,s:2,d2:7,r:0,mult:6,dt:3,rs:3},two:{tl:55,am:!1,a:31,d:6,s:1,d2:6,r:0,mult:5,rs:3,dt:3},three:{tl:19,am:!1,a:31,d:9,s:1,d2:6,r:0,mult:0,rs:2,dt:3},four:{tl:11,am:!1,a:31,d:6,s:15,d2:8,r:8,mult:1,rs:2,dt:3}}}),O=function(t){return function(e){var s=function(t){t.PhaseModulationSensitivity.set(e.fms),t.AmplitudeModulationSensitivity.set(e.ams),t.Feedback.set(e.fb),t.Algorithm.set(e.alg);var s=function(t,e){t.FmEnable.set(!e.am),t.Attack.set(e.a),t.Decay.set(e.d),t.Sustain.set(e.s),t.Release.set(e.r),t.SustainLevel.set(e.d2),t.Level.set(e.tl),t.Multiple.set(e.mult),t.Detune.set(e.dt),t.Scaling.set(e.rs),null!=e.ssg?(t.CustomEnvelopeEnable.set(!0),t.CustomEnvelope.set(e.ssg)):t.CustomEnvelopeEnable.set(!1)};s(t.Operator1,e.operators.one),s(t.Operator2,e.operators.two),s(t.Operator3,e.operators.three),s(t.Operator4,e.operators.four)};s(t.ChannelOne),s(t.ChannelTwo),s(t.ChannelThree),s(t.ChannelFour),s(t.ChannelFive),s(t.ChannelSix)}},m=s(19),S=s(48),_=function(){function t(e,s,i,n){Object(m.a)(this,t),this._chip=e,this._addr=s,this._bit=i,null!=n&&this.set(n)}return Object(S.a)(t,[{key:"bits",value:function(){return 1}},{key:"get",value:function(){var t=this._chip.read(this._addr);return function(t,e){return 0!==(1<<t&e)}(this._bit,t)}},{key:"set",value:function(t){var e=this._chip.read(this._addr),s=function(t,e,s){var i=1<<t;return s?e|i:255&e&~i}(this._bit,e,t);console.log("writing 0x".concat(s.toString(16)," to 0x").concat(this._addr.toString(16))),this._chip.write(this._addr,s)}}]),t}(),T=function(t){var e=t.start,s=t.end;return(0>=e&&0<=s?1:0)|(1>=e&&1<=s?2:0)|(2>=e&&2<=s?4:0)|(3>=e&&3<=s?8:0)|(4>=e&&4<=s?16:0)|(5>=e&&5<=s?32:0)|(6>=e&&6<=s?64:0)|(7>=e&&7<=s?128:0)},b=function(){function t(e,s,i,n){Object(m.a)(this,t),this._chip=e,this.lsbOrByte=s,this.msb=i,null!=n&&this.set(n)}return Object(S.a)(t,[{key:"bits",value:function(){return this.lsbOrByte.end-this.lsbOrByte.start+1+(null!=this.msb?this.msb.end-this.msb.start+1:0)}},{key:"get",value:function(){var t=(T(this.lsbOrByte)&this._chip.read(this.lsbOrByte.address))>>this.lsbOrByte.start&255,e=0;return null!=this.msb&&(e=(T(this.msb)&this._chip.read(this.msb.address))>>this.msb.start&255,e<<=1+this.lsbOrByte.end-this.lsbOrByte.start),e|t}},{key:"set",value:function(t){var e=this,s=function(t,s){var i,n=(s&(i=t.end-t.start+1,Math.pow(2,i)-1))<<t.start,h=function(t){var e=t.start,s=t.end;return(0>=e&&0<=s?0:1)|(1>=e&&1<=s?0:2)|(2>=e&&2<=s?0:4)|(3>=e&&3<=s?0:8)|(4>=e&&4<=s?0:16)|(5>=e&&5<=s?0:32)|(6>=e&&6<=s?0:64)|(7>=e&&7<=s?0:128)}(t),r=e._chip.read(t.address)&h|n;e._chip.write(t.address,r)};if(null!=this.msb&&this.msb.address<this.lsbOrByte.address&&s(this.lsbOrByte,t),null!=this.msb){var i=(2147483647&t)>>this.lsbOrByte.end-this.lsbOrByte.start+1;s(this.msb,i)}(null==this.msb||this.msb.address>this.lsbOrByte.address)&&s(this.lsbOrByte,t)}}]),t}(),v=function t(e,s){Object(m.a)(this,t),this._chip=e,this._offset=s,this.Level=void 0,this.Attack=void 0,this.Decay=void 0,this.Sustain=void 0,this.Release=void 0,this.Scaling=void 0,this.SustainLevel=void 0,this.Detune=void 0,this.Multiple=void 0,this.FmEnable=void 0,this.CustomEnvelope=void 0,this.CustomEnvelopeEnable=void 0,this.Detune=new b(e,{address:48+s,start:4,end:6}),this.Multiple=new b(e,{address:48+s,start:0,end:3}),this.Level=new b(e,{address:64+s,start:0,end:6}),this.Scaling=new b(e,{address:80+s,start:6,end:7}),this.FmEnable=new _(e,96+s,7),this.Attack=new b(e,{address:80+s,start:0,end:4}),this.Decay=new b(e,{address:96+s,start:0,end:4}),this.Sustain=new b(e,{address:112+s,start:0,end:4}),this.Release=new b(e,{address:128+s,start:0,end:3}),this.SustainLevel=new b(e,{address:128+s,start:4,end:7}),this.CustomEnvelope=new b(e,{address:144+s,start:0,end:2}),this.CustomEnvelopeEnable=new _(e,144+s,3)},g=function t(e,s){Object(m.a)(this,t),this._chip=e,this._channel=s,this.Operator1=void 0,this.Operator2=void 0,this.Operator3=void 0,this.Operator4=void 0,this.Frequency=void 0,this.Octave=void 0,this.Algorithm=void 0,this.Feedback=void 0,this.Left=void 0,this.Right=void 0,this.AmplitudeModulationSensitivity=void 0,this.PhaseModulationSensitivity=void 0;var i=s<4?s-1:s-1|256;this.Operator1=new v(e,i),this.Operator2=new v(e,i+8),this.Operator3=new v(e,i+4),this.Operator4=new v(e,i+12),this.Frequency=new b(e,{address:160+i,start:0,end:7},{address:160+i+4,start:0,end:2}),this.Octave=new b(e,{address:160+i+4,start:3,end:5}),this.Algorithm=new b(e,{address:176+i,start:0,end:2}),this.Feedback=new b(e,{address:176+i,start:3,end:5}),this.Left=new _(e,180+i,7),this.Right=new _(e,180+i,6),this.AmplitudeModulationSensitivity=new b(e,{address:180+i,start:4,end:5}),this.PhaseModulationSensitivity=new b(e,{address:180+i,start:0,end:2})},N=function t(e,s){var i=this;Object(m.a)(this,t),this.chip=void 0,this.LfoEnable=void 0,this.LfoFreq=void 0,this.TimerAFrequency=void 0,this.TimerBFrequency=void 0,this.TimerALoad=void 0,this.TimerBLoad=void 0,this.TimerAEnable=void 0,this.TimerBEnable=void 0,this.TimerARst=void 0,this.TimerBRst=void 0,this.Channel3Mode=void 0,this.Channel=void 0,this.OperatorS1Enable=void 0,this.OperatorS2Enable=void 0,this.OperatorS3Enable=void 0,this.OperatorS4Enable=void 0,this.DacOutput=void 0,this.DacEnable=void 0,this.ChannelOne=void 0,this.ChannelTwo=void 0,this.ChannelThree=void 0,this.ChannelFour=void 0,this.ChannelFive=void 0,this.ChannelSix=void 0,this.chip=e;var n=this.chip.write.bind(this.chip);this.chip.write=function(t,e){i.chip.read(t)===e||[40,160,164].includes(t)||s(),n(t,e)},this.LfoEnable=new _(this.chip,34,3),this.LfoFreq=new b(this.chip,{address:34,start:0,end:2}),this.TimerAFrequency=new b(this.chip,{address:37,start:0,end:1},{address:36,start:0,end:7}),this.TimerBFrequency=new b(this.chip,{address:38,start:0,end:7}),this.TimerALoad=new _(this.chip,39,0),this.TimerBLoad=new _(this.chip,39,1),this.TimerAEnable=new _(this.chip,39,2),this.TimerBEnable=new _(this.chip,39,3),this.TimerARst=new _(this.chip,39,4),this.TimerBRst=new _(this.chip,39,5),this.Channel3Mode=new b(this.chip,{address:39,start:6,end:7}),this.Channel=new b(this.chip,{address:40,start:0,end:7}),this.OperatorS1Enable=new _(this.chip,40,4),this.OperatorS2Enable=new _(this.chip,40,5),this.OperatorS3Enable=new _(this.chip,40,6),this.OperatorS4Enable=new _(this.chip,40,7),this.DacOutput=new b(this.chip,{address:42,start:0,end:7}),this.DacEnable=new _(this.chip,43,7),this.ChannelOne=new g(e,1),this.ChannelTwo=new g(e,2),this.ChannelThree=new g(e,3),this.ChannelFour=new g(e,4),this.ChannelFive=new g(e,5),this.ChannelSix=new g(e,6),e.init(7670448,44100),e.config(9),e.reset(),e.write(40,0)},C=function t(){if(Object(m.a)(this,t),this.init=function(t,e){P.debug&&console.log("OPN::init("+t+","+e+")"),this.chip?(this.chip.ST.clock=t||7670448,this.chip.ST.rate=e||44100):this.chip=new X(t,e),this.ratio=144,this.interval=P.mode,this.start=0,this.count=0,function(t){P.debug&&console.log("init_tables",t.CH.length);var e,s,i,n,h,r,o,a,c=Math.PI,u=Math.log,l=Math.pow,d=Math.sin,f=k.STEP/32,p=65536,O=w.RES_LEN<<1;for(i=0;i<w.RES_LEN;++i)for(1&(n=(0|(r=p/l(2,(i+1)*f)))>>4)?n=1+(n>>1):n>>=1,n<<=2,a=i<<1,w.tab[a+0]=n,w.tab[a+1]=-n,s=1;s<13;++s)o=a+0+s*O|0,w.tab[o]=w.tab[a]>>s,w.tab[o+1]=-w.tab[o];for(o=c/M.LEN,a=8/u(2),f=8/k.STEP,s=0;s<M.LEN;++s)1&(n=(h=(r=d((1+(s<<1))*o))>0?u(1/r)*a:u(-1/r)*a)*f|0)?n=1+(n>>1):n>>=1,L.sin[s]=(n<<1)+(r>=0?0:1);for(s=0;s<8;++s)for(n=0;n<128;++n)for(i=0;i<8;++i){for(a=0,h=0;h<7;++h)(n&1<<h)>0&&(a+=E.pm_output[(h<<3)+s][i]);e=(n<<8)+(s<<5),E.pm_table[e+i+0]=a,E.pm_table[e+(7^i)+8]=a,E.pm_table[e+i+16]=-a,E.pm_table[e+(7^i)+24]=-a}}(this.chip)},this.reset=function(){P.debug&&console.log("OPN::reset"),function(t){var e;for(y.SetPrescaler(t,144),t.OPN.eg.timer=0,t.OPN.eg.cnt=0,t.OPN.lfo.timer_overflow=0,t.OPN.lfo.timer=0,t.OPN.lfo.cnt=0,t.OPN.lfo.AM=126,t.OPN.lfo.PM=0,t.OPN.ST.TAC=0,t.OPN.ST.TBC=0,t.OPN.SL3.key_csm=0,t.dacen=0,t.dacout=0,K(t,48),t.OPN.ST.TB=0,t.OPN.ST.TA=0,P.mode?(t.OPN.ST.TBL=256<<L.TIMER_SH+4,t.OPN.ST.TAL=1024<<L.TIMER_SH):(t.OPN.ST.TBL=4096,t.OPN.ST.TAL=1024),function(t,e){e>t.CH.length&&(e=t.CH.length);for(;--e>-1;)t.CH[e].reset()}(t,6),e=182;e>=180;)3!==(3&e)&&(y.WriteReg(t,e,192),y.WriteReg(t,256|e,192)),--e;for(e=178;e>=30;)3!==(3&e)&&(y.WriteReg(t,e,0),y.WriteReg(t,256|e,0)),--e}(this.chip),this.start=0,this.count=0},this.write=function(t,e){this.chip.buffer[t]=e,P.debug>1&&console.log("OPN::write",t.toString(16),e.toString(16)),e&=255,this.chip.OPN.ST.address=511&t;var s=this.chip.OPN.ST.address;switch(496&s){case 32:switch(s){case 42:this.chip.dacout=(e-128|0)<<6;break;case 43:this.chip.dacen=!!(128&e);break;default:y.WriteMode(this.chip,s,e)}break;default:y.WriteReg(this.chip,s,e)}},this.readStatus=function(){return 255&this.chip.OPN.ST.status},this.read=function(t){var e;return null!==(e=this.chip.buffer[t])&&void 0!==e?e:0},this.update=function(t){var e=t*this.ratio;P.debug&&console.log("==== YM::update","samples="+t,"cycles="+e);for(var s,i,n,h,r=[[],[]],o=!!(192&this.chip.OPN.ST.mode),a=-1;++a<this.chip.CH.length;)o?this.chip.CH[a].canCSM&&-1===this.chip.CH[a].SLOT[H[0]].Incr&&(this.chip.CH[a].SLOT[H[0]].refresh_fc_eg(this.chip,this.chip.OPN.SL3.fc[1],this.chip.OPN.SL3.kcode[1]),this.chip.CH[a].SLOT[H[1]].refresh_fc_eg(this.chip,this.chip.OPN.SL3.fc[2],this.chip.OPN.SL3.kcode[2]),this.chip.CH[a].SLOT[H[2]].refresh_fc_eg(this.chip,this.chip.OPN.SL3.fc[0],this.chip.OPN.SL3.kcode[0]),this.chip.CH[a].SLOT[H[3]].refresh_fc_eg(this.chip,this.chip.CH[a].fc,this.chip.CH[a].kcode)):this.chip.CH[a].refresh_fc_eg(this.chip);P.debugArr.length=0;var c,u,l,d=this.chip.CH.length;for(a=-1;++a<t;){for(i=0,n=0,h=!!(2&this.chip.OPN.SL3.key_csm),c=!1,s=-1;++s<d;)this.chip.CH[s].outputs.out=0,this.chip.CH[s].update_ssg_eg(),this.chip.dacen&&this.chip.CH[s].canDAC&&!c?(this.chip.CH[s].outputs.out+=this.chip.dacout,c=!0):this.chip.CH[s].calculate(this.chip),this.chip.CH[s].outputs.out>8192?this.chip.CH[s].outputs.out=8192:this.chip.CH[s].outputs.out<-8192&&(this.chip.CH[s].outputs.out=-8192),this.chip.CH[s].muted||(i+=this.chip.CH[s].outputs.out&this.chip.CH[s].pan[0]|0,n+=this.chip.CH[s].outputs.out&this.chip.CH[s].pan[1]|0),h&&this.chip.CH[s].canCSM&&(this.chip.CH[s].keyOffCSM(this.chip,H[0]),this.chip.CH[s].keyOffCSM(this.chip,H[1]),this.chip.CH[s].keyOffCSM(this.chip,H[2]),this.chip.CH[s].keyOffCSM(this.chip,H[3]));if(q(this.chip),P.mode)for(this.chip.OPN.eg.timer+=this.chip.OPN.eg.timer_add;this.chip.OPN.eg.timer>=this.chip.OPN.eg.timer_overflow;)this.chip.OPN.eg.timer-=this.chip.OPN.eg.timer_overflow,++this.chip.OPN.eg.cnt,G(this.chip,this.chip.OPN.eg.cnt);else++this.chip.OPN.eg.timer,this.chip.OPN.eg.timer>=3&&(this.chip.OPN.eg.timer=0,++this.chip.OPN.eg.cnt,G(this.chip,this.chip.OPN.eg.cnt));r[0][a]=i,r[1][a]=n,this.chip.OPN.SL3.key_csm<<=1,U(this.chip),h&&(this.chip.OPN.SL3.key_csm=0)}return u=this.chip,l=t,(2&u.OPN.ST.mode)>0&&(P.mode?u.OPN.ST.TBC-=u.OPN.ST.timer_base*l:u.OPN.ST.TBC-=l,u.OPN.ST.TBC<=0&&((8&u.OPN.ST.mode)>0&&(u.OPN.ST.status|=2),u.OPN.ST.TBL?u.OPN.ST.TBC+=u.OPN.ST.TBL:u.OPN.ST.TBC=u.OPN.ST.TBL)),P.debugArr.length>0&&console.log(P.debugArr.join(", ")),r},this.config=function(t){L.bitmask=~((1<<w.BITS-t)-1);for(var e=this.chip.CH.length;--e>-1;)this.chip.CH[e].pan[0]&&(this.chip.CH[e].pan[0]=L.bitmask),this.chip.CH[e].pan[1]&&(this.chip.CH[e].pan[1]=L.bitmask)},this.toggle=function(t,e){t<6&&(this.chip.CH[t].muted=!e)},this.toString=function(){return this.chip.toString()},this.load=function(t){},this.save=function(t){},!this instanceof t)return new t;this.version=257,this.start=0,this.count=0,this.chip=null},P={hq_fm:0,dac_bits:8,maxcalc:0,debug:0,debugLocal:0,debugArr:[],mode:0,strict:0},L={FREQ_SH:16,EG_SH:16,LFO_SH:24,TIMER_SH:16};L.FREQ_MASK=(1<<L.FREQ_SH)-1;var k={BITS:10,MIN_ATT_INDEX:0};k.LEN=1<<k.BITS,k.STEP=128/k.LEN,k.MAX_ATT_INDEX=k.LEN-1;var A={ATT:4,DEC:3,SUS:2,REL:1,OFF:0},j={BITS:17};j.LEN=1<<j.BITS,j.MASK=j.LEN-1;var M={BITS:10};M.LEN=1<<M.BITS,M.MASK=M.LEN-1;var w={BITS:14,RES_LEN:256};w.TAB_LEN=26*w.RES_LEN,w.tab=new Array(w.TAB_LEN),k.QUIET=w.TAB_LEN>>3,L.sin=new Array(M.LEN),L.sl=function(){var t=function(t){return 4*t/k.STEP|0};return[t(0),t(1),t(2),t(3),t(4),t(5),t(6),t(7),t(8),t(9),t(10),t(11),t(12),t(13),t(14),t(31)]}(),A.RATE_STEPS=8,A.inc=[0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,2,1,2,1,2,1,2,1,2,1,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,4,2,4,2,4,2,4,2,4,2,4,4,4,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,4,4,4,8,4,8,4,8,4,8,4,8,4,8,8,8,4,8,8,8,8,8,8,8,8,8,8,8,16,16,16,16,16,16,16,16,0,0,0,0,0,0,0,0],A.rate_select=function(){var t=function(t){return t*A.RATE_STEPS|0};return[t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(18),t(0),t(0),t(0),t(0),t(2),t(2),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(0),t(1),t(2),t(3),t(4),t(5),t(6),t(7),t(8),t(9),t(10),t(11),t(12),t(13),t(14),t(15),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16),t(16)]}(),A.rate_shift=function(){var t=function(t){return 0|t};return[t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(11),t(10),t(10),t(10),t(10),t(9),t(9),t(9),t(9),t(8),t(8),t(8),t(8),t(7),t(7),t(7),t(7),t(6),t(6),t(6),t(6),t(5),t(5),t(5),t(5),t(4),t(4),t(4),t(4),t(3),t(3),t(3),t(3),t(2),t(2),t(2),t(2),t(1),t(1),t(1),t(1),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0),t(0)]}(),j.tab=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,4,4,4,5,5,6,6,7,8,8,8,8,1,1,1,1,2,2,2,2,2,3,3,3,4,4,4,5,5,6,6,7,8,8,9,10,11,12,13,14,16,16,16,16,2,2,2,2,2,3,3,3,4,4,4,5,5,6,6,7,8,8,9,10,11,12,13,14,16,17,19,20,22,22,22,22];var y={fktable:[0,0,0,0,0,0,0,1,2,3,3,3,3,3,3,3]},E={samples_per_step:[108,77,71,67,62,44,8,5],ams_depth_shift:[8,3,1,0],pm_output:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1],[0,0,1,1,2,2,2,3],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1],[0,0,0,0,1,1,1,1],[0,0,1,1,2,2,2,3],[0,0,2,3,4,4,5,6],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1],[0,0,0,0,1,1,1,1],[0,0,0,1,1,1,1,2],[0,0,1,1,2,2,2,3],[0,0,2,3,4,4,5,6],[0,0,4,6,8,8,10,12],[0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1],[0,0,0,1,1,1,2,2],[0,0,1,1,2,2,3,3],[0,0,1,2,2,2,3,4],[0,0,2,3,4,4,5,6],[0,0,4,6,8,8,10,12],[0,0,8,12,16,16,20,24],[0,0,0,0,0,0,0,0],[0,0,0,0,2,2,2,2],[0,0,0,2,2,2,4,4],[0,0,2,2,4,4,6,6],[0,0,2,4,4,4,6,8],[0,0,4,6,8,8,10,12],[0,0,8,12,16,16,20,24],[0,0,16,24,32,32,40,48],[0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4],[0,0,0,4,4,4,8,8],[0,0,4,4,8,8,12,12],[0,0,4,8,8,8,12,16],[0,0,8,12,16,16,20,24],[0,0,16,24,32,32,40,48],[0,0,32,48,64,64,80,96]],pm_table:new Array(32768)};y.CHAN=function(t){return 3&t},y.SLOT=function(t){return t>>2&3};var x,H=[0,2,1,3];function D(){function t(){this.ar=0,this.d1r=0,this.d2r=0,this.rr=0,this.init=function(){this.ar=0,this.d1r=0,this.d2r=0,this.rr=0}}this.DT=-1,this.KSR=0,this.rate=new function(){this.ar=0,this.d1r=0,this.d2r=0,this.rr=0,this.ksr=0,this.mul=1,this.init=function(){this.ar=0,this.d1r=0,this.d2r=0,this.rr=0,this.ksr=0,this.mul=1},this.toString=function(){return["MUL="+this.mul,"KS="+this.ksr,"AR="+this.ar,"D1R="+this.d1r,"D2R="+this.d2r,"RR="+this.rr].join(",")}},this.phase=0,this.Incr=0,this.state=0,this.tl=0,this.volume=0,this.sl=0,this.vol_out=0,this.eg={sh:new t,sel:new t,init:function(){this.sh.init(),this.sel.init()}},this.ssg=0,this.ssgn=0,this.key=0,this.AMmask=0,this.reset=function(){this.Incr=-1,this.key=0,this.phase=0,this.ssgn=0,this.state=A.OFF,this.volume=k.MAX_ATT_INDEX,this.vol_out=k.MAX_ATT_INDEX,this.out[0]=0,this.out[1]=0},this.debug={dt1mul:0,dt1:0,mul:0,tl:0,ksar:0,ks:0,ar:0,amd1r:0,am:0,d1r:0,d2r:0,slrr:0,sl:0,rr:0},this.debug.toString=function(){return["TL:"+this.tl,"DT1:"+this.dt1,"MUL:"+this.mul,"KS:"+this.ks,"AR:"+this.ar,"AM:"+this.am,"D1R:"+this.d1r,"D2R:"+this.d2r,"SL:"+this.sl,"RR:"+this.rr].join(",")},this.out=[0,0],this.toString=function(){return"OP{"+this.debug.toString()+"}"}}function I(){this.SLOT=[new D,new D,new D,new D],this.ALGO=0,this.FB=0,this.op1_out=[0,0],this.connect=["x","x","x","x"],this.mem={connect:"mem",value:0},this.pms=0,this.ams=0,this.fc=0,this.kcode=0,this.block_fnum=0,this.fn_h=0,this.outputs={m1:0,m2:0,c1:0,c2:0,mem:0,x:0,out:0},this.canCSM=0,this.canDAC=0,this.muted=0,this.pan=[0,0],this.reset=function(){this.mem.value=0,this.op1_out[0]=0,this.op1_out[1]=0;for(var t=this.SLOT.length;--t>-1;)this.SLOT[t].reset()},this.toString=function(){return"CH{"+["ALGO:"+this.ALGO,"FB:"+this.FB,"PMS:"+this.pms,"AMS:"+this.ams,"SLOTS["+this.SLOT.join(",")+"]"].join(",")+"}"}}function B(t,e){this.address=0,this.status=0,this.mode=0,this.timer_base=1,this.TA=0,this.TAL=0,this.TAC=0,this.TB=0,this.TBL=0,this.TBC=0,this.dt_tab=[new Array(32),new Array(32),new Array(32),new Array(32),new Array(32),new Array(32),new Array(32),new Array(32)],this.clock=t||7670448,this.rate=e||44100}function F(){this.fc=[0,0,0],this.fn_h=0,this.kcode=[0,0,0],this.block_fnum=[0,0,0],this.key_csm=0}function R(t,e){function s(){this.cnt=0,this.timer=0,this.timer_add=0,this.timer_overflow=0,this.init=function(){this.cnt=0,this.timer=0,this.timer_add=0,this.timer_overflow=0}}this.ST=new B(t,e),this.SL3=new F,this.eg=new s,this.lfo=new s,this.lfo.AM=0,this.lfo.PM=0,this.fn={table:new Array(4096),max:0}}function X(t,e){this.CH=[new I,new I,new I,new I,new I,new I],this.CH[2].canCSM=1,this.CH[5].canDAC=1,this.dacen=0,this.dacout=0,this.OPN=new R(t,e),this.toString=function(){return"YM[\n"+this.CH.join(",\n")+"\n]"},this.buffer=new Array(512).fill(0)}function U(t){(1&t.OPN.ST.mode)>0&&(P.mode?t.OPN.ST.TAC-=t.OPN.ST.timer_base:--t.OPN.ST.TAC,t.OPN.ST.TAC<=0&&((4&t.OPN.ST.mode)>0&&(t.OPN.ST.status|=1),P.mode&&t.OPN.ST.TAL?t.OPN.ST.TAC+=t.OPN.ST.TAL:t.OPN.ST.TAC=t.OPN.ST.TAL,128===(192&t.OPN.ST.mode)&&t.CH[2].keyControlCSM()))}function K(t,e){(192&(t.OPN.ST.mode^e))>0&&(t.CH[2].SLOT[H[0]].Incr=-1,128!==(192&e)&&t.OPN.SL3.key_csm&&(t.CH[2].keyOffCSM(H[0]),t.CH[2].keyOffCSM(H[1]),t.CH[2].keyOffCSM(H[2]),t.CH[2].keyOffCSM(H[3]),t.OPN.SL3.key_csm=0)),1&e&&!(1&t.OPN.ST.mode)&&(t.OPN.ST.TAC=t.OPN.ST.TAL),2&e&&!(2&t.OPN.ST.mode)&&(t.OPN.ST.TBC=t.OPN.ST.TBL),t.OPN.ST.status&=~e>>4,t.OPN.ST.mode=e}function q(t){var e;e=P.mode?function(t){for(;t.lfo.timer>=t.lfo.timer_overflow;)t.lfo.timer-=t.lfo.timer_overflow,t.lfo.cnt=t.lfo.cnt+1&127,t.lfo.cnt<64?t.lfo.AM=(63^t.lfo.cnt)<<1:t.lfo.AM=(63&t.lfo.cnt)<<1,t.lfo.PM=t.lfo.cnt>>2}:function(t){t.lfo.timer>t.lfo.timer_overflow&&(t.lfo.timer=0,t.lfo.cnt=t.lfo.cnt+1&127,t.lfo.cnt<64?t.lfo.AM=(63^t.lfo.cnt)<<1:t.lfo.AM=(63&t.lfo.cnt)<<1,t.lfo.PM=t.lfo.cnt>>2)},t.OPN.lfo.timer_overflow&&(P.mode?t.OPN.lfo.timer+=t.OPN.lfo.timer_add:++t.OPN.lfo.timer,e(t.OPN))}function G(t,e){for(var s=t.CH.length;--s>-1;)t.CH[s].advance_eg(e)}L.bitmask=0,D.prototype.keyOn=function(t,e){this.key||t.OPN.SL3.key_csm||(this.phase=0,this.ssgn=0,this.rate.ar+this.rate.ksr<94?this.state=this.volume<=k.MIN_ATT_INDEX?this.sl===k.MIN_ATT_INDEX?A.SUS:A.DEC:A.ATT:(this.volume=k.MIN_ATT_INDEX,this.state=this.sl===k.MIN_ATT_INDEX?A.SUS:A.DEC),(8&this.ssg)>0&&(this.ssgn^4&this.ssg)>0?this.vol_out=this.tl+(512-this.volume&k.MAX_ATT_INDEX):this.vol_out=this.tl+(0|this.volume)),e||(this.key=1)},I.prototype.keyOn=function(t,e){this.SLOT[e].keyOn(t,0)},D.prototype.keyOff=function(t,e){(e&&!this.key||!e&&this.key&&!t.OPN.SL3.key_csm)&&this.state>A.REL&&(this.state=A.REL,(8&this.ssg)>0&&((this.ssgn^4&this.ssg)>0&&(this.volume=512-this.volume|0),this.volume>=512&&(this.volume=k.MAX_ATT_INDEX,this.state=A.OFF),this.vol_out=this.tl+(0|this.volume))),e||(this.key=0)},I.prototype.keyOff=function(t,e){this.SLOT[e].keyOff(t,0)},I.prototype.keyOnCSM=function(t,e){this.SLOT[e].keyOn(t,1)},I.prototype.keyOffCSM=function(t,e){this.SLOT[e].keyOff(t,1)},I.prototype.keyControlCSM=function(t){this.keyOnCSM(H[0]),this.keyOnCSM(H[1]),this.keyOnCSM(H[2]),this.keyOnCSM(H[3]),t.OPN.SL3.key_csm=1},I.prototype.setupConnection=function(){var t="out",e=0,s=2,i=1;this.mem.connect;switch(this.ALGO){case 0:this.connect[e]="c1",this.connect[i]="mem",this.connect[s]="c2",this.mem.connect="m2";break;case 1:this.connect[e]="mem",this.connect[i]="mem",this.connect[s]="c2",this.mem.connect="m2";break;case 2:this.connect[e]="c2",this.connect[i]="mem",this.connect[s]="c2",this.mem.connect="m2";break;case 3:this.connect[e]="c1",this.connect[i]="mem",this.connect[s]="c2",this.mem.connect="c2";break;case 4:this.connect[e]="c1",this.connect[i]=t,this.connect[s]="c2",this.mem.connect="mem";break;case 5:this.connect[e]="x",this.connect[i]=t,this.connect[s]=t,this.mem.connect="m2";break;case 6:this.connect[e]="c1",this.connect[i]=t,this.connect[s]=t,this.mem.connect="mem";break;case 7:this.connect[e]=t,this.connect[i]=t,this.connect[s]=t,this.mem.connect="mem";break;default:if(P.strict)throw new Error("CH::setup_connection - unsupported algorithm ("+this.ALGO+")")}this.connect[3]=t},D.prototype.set_det_mul=function(t,e){this.rate.mul=(15&e)>0?(15&e)<<1:1,this.DT=e>>4&7,this.debug.dt1mul=255&e,this.debug.dt1=this.DT,this.debug.mul=15&e},I.prototype.set_det_mul=function(t,e,s){this.SLOT[e].set_det_mul(t,s),this.SLOT[H[0]].Incr=-1},D.prototype.set_tl=function(t){this.debug.tl=127&t,this.tl=this.debug.tl<<k.BITS-7,(8&this.ssg)>0&&(this.ssgn^4&this.ssg)>0&&this.state>A.REL?this.vol_out=this.tl+((512-this.volume|0)&k.MAX_ATT_INDEX):this.vol_out=this.tl+(0|this.volume)},I.prototype.set_tl=function(t,e){this.SLOT[t].set_tl(e)},D.prototype.set_ar_ksr=function(t){this.debug.ksar=255&t,this.debug.ks=t>>6,this.debug.ar=31&t;var e=0|this.KSR;if(this.rate.ar=this.debug.ar>0?32+(this.debug.ar<<1):0,this.KSR=3-this.debug.ks,this.rate.ar+this.rate.ksr<94){var s=this.rate.ar+this.rate.ksr|0;this.eg.sh.ar=A.rate_shift[s],this.eg.sel.ar=A.rate_select[s]}else this.eg.sh.ar=0,this.eg.sel.ar=18*A.RATE_STEPS;return this.KSR!==e},I.prototype.set_ar_ksr=function(t,e){this.SLOT[t].set_ar_ksr(e)&&(this.SLOT[H[0]].Incr=-1)},D.prototype.set_dr=function(t){this.debug.amd1r=255&t,this.debug.am=128&t,this.debug.d1r=31&t,this.rate.d1r=this.debug.d1r>0?32+(this.debug.d1r<<1):0;var e=this.rate.d1r+this.rate.ksr|0;this.eg.sh.d1r=A.rate_shift[e],this.eg.sel.d1r=A.rate_select[e]},I.prototype.set_dr=function(t,e){this.SLOT[t].set_dr(e)},D.prototype.set_sr=function(t){this.debug.d2r=31&t,this.rate.d2r=this.debug.d2r>0?32+(this.debug.d2r<<1):0;var e=this.rate.d2r+this.rate.ksr|0;this.eg.sh.d2r=A.rate_shift[e],this.eg.sel.d2r=A.rate_select[e]},I.prototype.set_sr=function(t,e){this.SLOT[t].set_sr(e)},D.prototype.set_sl_rr=function(t){this.debug.slrr=255&t,this.debug.sl=t>>4&15,this.debug.rr=15&t,this.sl=L.sl[this.debug.sl],this.state===A.DEC&&this.volume>=(0|this.sl)&&(this.state=A.SUS),this.rate.rr=34+(this.debug.rr<<2);var e=this.rate.rr+this.rate.ksr|0;this.eg.sh.rr=A.rate_shift[e],this.eg.sel.rr=A.rate_select[e]},I.prototype.set_sl_rr=function(t,e){this.SLOT[t].set_sl_rr(e)},D.prototype.advance_eg=function(t){switch(this.state){case A.ATT:t&(1<<this.eg.sh.ar)-1||(this.volume+=~this.volume*A.inc[this.eg.sel.ar+(t>>this.eg.sh.ar&7)]>>4,this.volume<=k.MIN_ATT_INDEX&&(this.volume=k.MIN_ATT_INDEX,this.state=this.sl===k.MIN_ATT_INDEX?A.SUS:A.DEC),(8&this.ssg)>0&&(this.ssgn^4&this.ssg)>0?this.vol_out=this.tl+((512-this.volume|0)&k.MAX_ATT_INDEX):this.vol_out=this.tl+(0|this.volume));break;case A.DEC:t&(1<<this.eg.sh.d1r)-1||((8&this.ssg)>0?this.volume<512&&(this.volume+=A.inc[this.eg.sel.d1r+(t>>this.eg.sh.d1r&7)]<<2,(this.ssgn^4&this.ssg)>0?this.vol_out=this.tl+((512-this.volume|0)&k.MAX_ATT_INDEX):this.vol_out=this.tl+(0|this.volume)):(this.volume+=A.inc[this.eg.sel.d1r+(t>>this.eg.sh.d1r&7)],this.vol_out=this.tl+(0|this.volume)),this.volume>=(0|this.sl)&&(this.state=A.SUS));break;case A.SUS:t&(1<<this.eg.sh.d2r)-1||((8&this.ssg)>0?this.volume<512&&(this.volume+=A.inc[this.eg.sel.d2r+(t>>this.eg.sh.d2r&7)]<<2,(this.ssgn^4&this.ssg)>0?this.vol_out=this.tl+((512-this.volume|0)&k.MAX_ATT_INDEX):this.vol_out=this.tl+(0|this.volume)):(this.volume+=A.inc[this.eg.sel.d2r+(t>>this.eg.sh.d2r&7)],this.volume>=k.MAX_ATT_INDEX&&(this.volume=k.MAX_ATT_INDEX),this.vol_out=this.tl+(0|this.volume)));break;case A.REL:t&(1<<this.eg.sh.rr)-1||((8&this.ssg)>0?this.volume<512&&(this.volume+=A.inc[this.eg.sel.rr+(t>>this.eg.sh.rr&7)]<<2,this.volume>=512&&(this.volume=k.MAX_ATT_INDEX,this.state=A.OFF)):(this.volume+=A.inc[this.eg.sel.rr+(t>>this.eg.sh.rr&7)],this.volume>=k.MAX_ATT_INDEX&&(this.volume=k.MAX_ATT_INDEX,this.state=A.OFF)),this.vol_out=this.tl+(0|this.volume));break;default:if(P.strict)throw new Error("FM_SLOT::advance_eg - unsupported state ("+this.state+")")}},I.prototype.advance_eg=function(t){for(var e=this.SLOT.length;--e>-1;)this.SLOT[e].advance_eg(t)},D.prototype.update_ssg_eg=function(){(8&this.ssg)>0&&this.volume>=512&&this.state>A.REL&&((1&this.ssg)>0?((2&this.ssg)>0&&(this.ssgn=4),this.state===A.ATT||this.ssgn^4&this.ssg||(this.volume=k.MAX_ATT_INDEX)):((2&this.ssg)>0?this.ssgn^=4:this.phase=0,this.state!==A.ATT&&(this.rate.ar+this.rate.ksr<94?this.state=this.volume<=k.MIN_ATT_INDEX?this.sl===k.MIN_ATT_INDEX?A.SUS:A.DEC:A.ATT:(this.volume=k.MIN_ATT_INDEX,this.state=this.sl===k.MIN_ATT_INDEX?A.SUS:A.DEC))),(this.ssgn^4&this.ssg)>0?this.vol_out=this.tl+((512-this.volume|0)&k.MAX_ATT_INDEX):this.vol_out=this.tl+(0|this.volume))},I.prototype.update_ssg_eg=function(){for(var t=this.SLOT.length;--t>-1;)this.SLOT[t].update_ssg_eg()},D.prototype.update_phase_lfo=function(t,e,s){var i=E.pm_table[((2032&s)>>4<<8)+e+t.OPN.lfo.PM];if(i){if(this.DT<0){if(console.log("FM_SLOT::update_phase_lfo - invalid DT",this.DT),P.strict)throw new Error("FM_SLOT::update_phase_lfo - invalid DT="+this.DT);return}var n,h,r;n=(28672&(s=i+(s<<1)))>>12,s&=4095,h=n<<2|y.fktable[s>>8],P.mode?(r=(t.OPN.fn.table[s]>>7-n)+t.OPN.ST.dt_tab[this.DT][h])<0&&(r+=t.OPN.fn.max):r=(s<<5>>7-n)+t.OPN.ST.dt_tab[this.DT][h]&j.MASK,this.phase+=r*this.rate.mul>>1}else this.phase+=this.Incr},D.prototype.update_phase_lfo_precalc=function(t,e,s){var i;-1!==e?(P.mode?(i=e+t.OPN.ST.dt_tab[this.DT][s])<0&&(i+=t.OPN.fn.max):i=e+t.OPN.ST.dt_tab[this.DT][s]&j.MASK,this.phase+=i*this.rate.mul>>1):this.phase+=this.Incr},I.prototype.update_phase_lfo=function(t){var e,s,i,n=this.pms,h=this.block_fnum,r=E.pm_table[((2032&h)>>4<<8)+n+t.OPN.lfo.PM];r?(e=(28672&(h=r+(h<<1)))>>12,h&=4095,s=e<<2|y.fktable[h>>8],i=P.mode?t.OPN.fn.table[h]>>7-e:h<<5>>7-e):i=-1;for(var o=this.SLOT.length;--o>-1;)this.SLOT[H[o]].update_phase_lfo_precalc(t,i,s)},D.prototype.refresh_fc_eg=function(t,e,s){if(this.DT<0){if(console.log("FM_SLOT::refresh_fc_eg - invalid DT",this.DT),P.strict)throw new Error("FM_SLOT::refresh_fc_eg - invalid DT="+this.DT)}else if(P.debug>1&&console.log("OPN.ST.dt_tab["+this.DT+"]["+s+"]",t.OPN.ST.dt_tab[this.DT][s]),e+=t.OPN.ST.dt_tab[this.DT][s],P.mode?e<0&&(e+=t.OPN.fn.max):e&=j.MASK,this.Incr=e*this.rate.mul>>1,s>>=this.KSR,this.rate.ksr!==s){this.rate.ksr=s;var i=this.rate.ar+s|0;i<94?(this.eg.sh.ar=A.rate_shift[i],this.eg.sel.ar=A.rate_select[i]):(this.eg.sh.ar=0,this.eg.sel.ar=18*A.RATE_STEPS),i=this.rate.d1r+s|0,this.eg.sh.d1r=A.rate_shift[i],this.eg.sel.d1r=A.rate_select[i],i=this.rate.d2r+s|0,this.eg.sh.d2r=A.rate_shift[i],this.eg.sel.d2r=A.rate_select[i],i=this.rate.rr+s|0,this.eg.sh.rr=A.rate_shift[i],this.eg.sel.rr=A.rate_select[i]}},I.prototype.refresh_fc_eg=function(t){if(-1===this.SLOT[H[0]].Incr){var e=0|this.fc,s=0|this.kcode;P.debug>1&&console.log("FM_CH::refresh_fc_eg",e,s);for(var i=this.SLOT.length;--i>-1;)this.SLOT[H[i]].refresh_fc_eg(t,e,s)}},D.prototype.calcVol=function(t){return this.vol_out+(t&this.AMmask)|0},x=P.mode?function(t,e,s,i){var n=(e<<3)+L.sin[(t&~L.FREQ_MASK)+(i?s:s<<15)>>L.FREQ_SH&M.MASK];return n>=w.TAB_LEN?0:w.tab[n]}:function(t,e,s,i){var n=(e<<3)+L.sin[(i?t+s>>M.BITS:(t>>M.BITS)+(s>>1))&M.MASK];return n>=w.TAB_LEN?0:w.tab[n]},D.prototype.calculate=function(t,e,s){var i=this.vol_out+(e&this.AMmask)|0,n=0;if(s){var h=this.out[0]+this.out[1]|0;this.out[0]=0|this.out[1],n=0|this.out[0],i<k.QUIET?(t||(h=0),this.out[1]=x(this.phase,i,h<<t,1)):this.out[1]=0}else i<k.QUIET?(this.out[0]=x(this.phase,i,t,0),n=0|this.out[0]):n=this.out[0]=0;return n},I.prototype.calculate=function(t){var e,s,i="",n=P.debug>1&&P.maxcalc>0,h=t.OPN.lfo.AM>>this.ams,r=["x","c1","m2","c2"];this.outputs.m2=0,this.outputs.c1=0,this.outputs.c2=0,this.outputs.mem=0,this.outputs.x=0,this.outputs[this.mem.connect]=this.mem.value,s=0,0!==(e=this.SLOT[H[s]].calculate(this.FB,h,1))&&("x"===this.connect[s]?(this.outputs.x=e,this.outputs.mem=e,this.outputs.c1=e,this.outputs.c2=e):this.outputs[this.connect[s]]+=e),s=2,0!==(e=this.SLOT[H[s]].calculate(this.outputs[r[s]],h,0))&&("x"===this.connect[s]||(this.outputs[this.connect[s]]+=e)),s=1,0!==(e=this.SLOT[H[s]].calculate(this.outputs[r[s]],h,0))&&("x"===this.connect[s]||(this.outputs[this.connect[s]]+=e)),s=3,0!==(e=this.SLOT[H[s]].calculate(this.outputs[r[s]],h,0))&&("x"===this.connect[s]||(this.outputs[this.connect[s]]+=e)),this.mem.value=0|this.outputs.mem,this.pms?(192&t.OPN.ST.mode)>0&&this.canCSM?(this.SLOT[H[0]].update_phase_lfo(t,this.pms,t.OPN.SL3.block_fnum[1]),this.SLOT[H[1]].update_phase_lfo(t,this.pms,t.OPN.SL3.block_fnum[2]),this.SLOT[H[2]].update_phase_lfo(t,this.pms,t.OPN.SL3.block_fnum[0]),this.SLOT[H[3]].update_phase_lfo(t,this.pms,this.block_fnum)):this.update_phase_lfo(t):(this.SLOT[H[0]].phase+=this.SLOT[H[0]].Incr,this.SLOT[H[1]].phase+=this.SLOT[H[1]].Incr,this.SLOT[H[2]].phase+=this.SLOT[H[2]].Incr,this.SLOT[H[3]].phase+=this.SLOT[H[3]].Incr),n&&(i+="; m2="+this.outputs.m2+";c1="+this.outputs.c1+";c2="+this.outputs.c2+";out="+this.outputs.out,console.log("FM_CH::calc",this.ALGO,i),--P.maxcalc)},y.WriteMode=function(t,e,s){switch(s&=255,e){case 33:break;case 34:8&s?P.mode?t.OPN.lfo.timer_overflow=E.samples_per_step[7&s]<<L.LFO_SH:t.OPN.lfo.timer_overflow=E.samples_per_step[7&s]:(t.OPN.lfo.timer_overflow=0,t.OPN.lfo.timer=0,t.OPN.lfo.cnt=0,t.OPN.lfo.AM=126,t.OPN.lfo.PM=0);break;case 36:t.OPN.ST.TA=3&t.OPN.ST.TA|(0|s)<<2,t.OPN.ST.TAL=1024-t.OPN.ST.TA,P.mode&&(t.OPN.ST.TAL<<=L.TIMER_SH);break;case 37:t.OPN.ST.TA=1020&t.OPN.ST.TA|3&s,t.OPN.ST.TAL=1024-t.OPN.ST.TA,P.mode&&(t.OPN.ST.TAL<<=L.TIMER_SH);break;case 38:t.OPN.ST.TB=s,P.mode?t.OPN.ST.TBL=256-s<<L.TIMER_SH+4:t.OPN.ST.TBL=256-s<<4;break;case 39:K(t,s);break;case 40:var i=3&s;if(3===i)break;4&s&&(i+=3),n=t.CH[i],16&s?n.keyOn(t,H[0]):n.keyOff(t,H[0]),32&s?n.keyOn(t,H[1]):n.keyOff(t,H[1]),64&s?n.keyOn(t,H[2]):n.keyOff(t,H[2]),128&s?n.keyOn(t,H[3]):n.keyOff(t,H[3])}var n},y.WriteReg=function(t,e,s){s&=255;var i=y.CHAN(e),n=y.SLOT(e);if(i>=3){if(P.strict)throw new Error("OPN_Write - unsupported channel "+i+" or slot "+n+" from {$"+e.toString(16)+",$"+s.toString(16)+"}")}else{e>=256&&(i+=3);var h;H[n];switch(240&e){case 48:t.CH[i].set_det_mul(t,n,s);break;case 64:t.CH[i].set_tl(n,s);break;case 80:t.CH[i].set_ar_ksr(n,s);break;case 96:t.CH[i].set_dr(n,s),t.CH[i].SLOT[n].AMmask=128&s?-1:0;break;case 112:t.CH[i].set_sr(n,s);break;case 128:t.CH[i].set_sl_rr(n,s);break;case 144:(h=t.CH[i].SLOT[n]).ssg=15&s,h.state>A.REL&&((8&h.ssg)>0&&(h.ssgn^4&h.ssg)>0?h.vol_out=h.tl+((512-h.volume|0)&k.MAX_ATT_INDEX):h.vol_out=h.tl+(0|h.volume));break;case 160:var r,o;switch(n){case 0:r=((7&t.CH[i].fn_h)<<8)+s,o=t.CH[i].fn_h>>3&255,t.CH[i].kcode=o<<2|y.fktable[r>>7],P.mode?t.CH[i].fc=t.OPN.fn.table[r<<1]>>7-o:t.CH[i].fc=r<<6>>7-o,t.CH[i].block_fnum=o<<11|r,t.CH[i].SLOT[H[0]].Incr=-1,P.debug>2&&console.log("block_fnum=x",t.CH[i].block_fnum.toString(16)," kcode=",t.CH[i].kcode.toString(16)," fc=",t.CH[i].fc.toString(16));break;case 1:t.CH[i].fn_h=63&s|0;break;case 2:e<256&&(r=((7&t.OPN.SL3.fn_h)<<8)+s,o=t.OPN.SL3.fn_h>>3,t.OPN.SL3.kcode[i]=o<<2|y.fktable[r>>7],P.mode?t.OPN.SL3.fc[i]=t.OPN.fn.table[r<<1]>>7-o:t.OPN.SL3.fc[i]=r<<6>>7-o,t.OPN.SL3.block_fnum[i]=o<<11|r,t.CH[2].SLOT[H[0]].Incr=-1);break;case 3:e<256&&(t.OPN.SL3.fn_h=63&s)}break;case 176:switch(n){case 0:var a=s>>3&7;t.CH[i].ALGO=7&s,P.mode?t.CH[i].FB=a?a+6:0:t.CH[i].FB=a,t.CH[i].setupConnection();break;case 1:t.CH[i].pms=(7&s)<<5,t.CH[i].ams=E.ams_depth_shift[s>>4&3],t.CH[i].pan[0]=128&s?L.bitmask:0,t.CH[i].pan[1]=64&s?L.bitmask:0}}}},y.SetPrescaler=function(t,e){var s,i,n;t.ratio=e||144,t.OPN.ST.scale=t.OPN.ST.clock/t.OPN.ST.rate/t.ratio,P.debug&&console.log("init_timetables",t.OPN.ST.clock,t.OPN.ST.rate,t.ratio,t.OPN.ST.scale);var h=t.OPN.ST.scale*(1<<L.FREQ_SH-10);for(s=0;s<4;++s)for(i=0;i<32;++i)n=j.tab[(s<<5)+i],P.mode&&(n*=h),t.OPN.ST.dt_tab[s][i]=0|n,t.OPN.ST.dt_tab[s+4][i]=-t.OPN.ST.dt_tab[s][i];for(P.debug>2&&console.log("init_timetables dt_tab",t.OPN.ST.dt_tab),n=32*h,i=4096;--i>-1;)t.OPN.fn.table[i]=i*n|0;t.OPN.fn.max=131072*h|0,t.OPN.eg.timer_add=t.OPN.ST.scale*(1<<L.EG_SH)|0,t.OPN.eg.timer_overflow=3*(1<<L.EG_SH),t.OPN.lfo.timer_add=t.OPN.ST.scale*(1<<L.LFO_SH)|0,t.OPN.ST.timer_base=t.OPN.ST.scale*(1<<L.TIMER_SH)|0};var W=C,Q=function(t){var e=n.useMemo((function(){return function(t){var e=new N(new W,t);return O(e)(p),e}(t)}),[]);return n.useEffect((function(){return function(t,e){var s=t.createScriptProcessor();return s.onaudioprocess=function(t){var s=t.outputBuffer,i=e.chip.update(s.length);s.copyToChannel(new Float32Array(i[0].map((function(t){return t/65356}))),0,0),s.copyToChannel(new Float32Array(i[1].map((function(t){return t/65356}))),1,0)},s.connect(t.destination),function(){s.disconnect(t.destination),t.close()}}(new AudioContext,e)}),[e]),e},z=s(26),Y=s(91),J=s(99),$=s(101),V=s(102),Z=function(t){return Math.pow(2,t)-1},tt=function(t){var e=t.context,s=n.useMemo((function(){return t=e,function(e){return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)(z.a,{id:"synth-control-".concat(e.name),children:[Object(i.jsx)(Y.a,{children:e.name}),Object(i.jsxs)(J.c,{size:"sm",id:"synth-control-num-".concat(e.name),value:e.field(t).get(),min:0,max:Z(e.field(t).bits()),onChange:function(s,i){e.field(t).set(i)},children:[Object(i.jsx)(J.d,{}),Object(i.jsxs)(J.e,{children:[Object(i.jsx)(J.b,{}),Object(i.jsx)(J.a,{})]})]})]})})};var t}),[e]),h=n.useMemo((function(){return t=e,function(e){return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)(z.a,{id:"synth-control-".concat(e.name),children:[Object(i.jsx)(Y.a,{children:e.name}),Object(i.jsx)($.a,{isChecked:e.field(t).get(),onChange:function(s){return e.field(t).set(s.target.checked)}})]})})};var t}),[e]),r=function(t){var e=function(e){return Object(i.jsx)(s,{name:e,field:function(s){return t.operatorSelector(s)[e]}},"".concat(e,"-").concat(t.operator))},n=function(e){return Object(i.jsx)(h,{name:e,field:function(s){return t.operatorSelector(s)[e]}},"".concat(e,"-").concat(t.operator))};return Object(i.jsx)(i.Fragment,{children:[e("Level"),e("Attack"),e("Decay"),e("Sustain"),e("Release"),e("SustainLevel"),e("Scaling"),e("Detune"),e("Multiple"),e("CustomEnvelope"),n("CustomEnvelopeEnable"),n("FmEnable")]})};return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)(V.a,{direction:"row",children:[Object(i.jsxs)("div",{children:[Object(i.jsx)(l.a,{size:"xs",children:"Operator 1"}),Object(i.jsx)(r,{operator:1,operatorSelector:function(t){return t.ChannelOne.Operator1}})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(l.a,{size:"xs",children:"Operator 2"}),Object(i.jsx)(r,{operator:2,operatorSelector:function(t){return t.ChannelOne.Operator2}})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(l.a,{size:"xs",children:"Operator 3"}),Object(i.jsx)(r,{operator:3,operatorSelector:function(t){return t.ChannelOne.Operator3}})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(l.a,{size:"xs",children:"Operator 4"}),Object(i.jsx)(r,{operator:4,operatorSelector:function(t){return t.ChannelOne.Operator4}})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)(l.a,{size:"xs",children:"Channel Params"}),Object(i.jsx)(s,{name:"Algorithm",field:function(t){return t.ChannelOne.Algorithm}}),Object(i.jsx)(s,{name:"Feedback",field:function(t){return t.ChannelOne.Feedback}}),Object(i.jsx)(s,{name:"AmplitudeModulationSensitivity",field:function(t){return t.ChannelOne.AmplitudeModulationSensitivity}}),Object(i.jsx)(s,{name:"PhaseModulationSensitivity",field:function(t){return t.ChannelOne.PhaseModulationSensitivity}}),Object(i.jsx)(h,{name:"Left",field:function(t){return t.ChannelOne.Left}}),Object(i.jsx)(h,{name:"Right",field:function(t){return t.ChannelOne.Right}}),Object(i.jsx)(l.a,{size:"xs",children:"Operator Flags"}),Object(i.jsx)(h,{name:"Operator1Enable",field:function(t){return t.OperatorS1Enable}}),Object(i.jsx)(h,{name:"Operator2Enable",field:function(t){return t.OperatorS2Enable}}),Object(i.jsx)(h,{name:"Operator3Enable",field:function(t){return t.OperatorS3Enable}}),Object(i.jsx)(h,{name:"Operator4Enable",field:function(t){return t.OperatorS4Enable}}),Object(i.jsx)(l.a,{size:"xs",children:"LFO"}),Object(i.jsx)(h,{name:"LfoEnable",field:function(t){return t.LfoEnable}}),Object(i.jsx)(s,{name:"LfoFreq",field:function(t){return t.LfoFreq}})]})]})})},et=s(100),st=function(t){var e=t.synth,s=n.useState(4),h=Object(a.a)(s,2),r=h[0],o=h[1],c=n.useCallback((function(t){e.ChannelOne.Octave.set(r),e.ChannelOne.Frequency.set(t),e.Channel.set(240)}),[e,r]),u=n.useCallback((function(){e.Channel.set(0)}),[e]),l=617,d=653,f=692,p=733,O=777,m=823,S=872,_=924,T=979,b=1037,v=1099,g=1164;return Object(i.jsxs)(V.a,{direction:"row",children:[Object(i.jsx)(et.a,{onMouseDown:function(){return c(l)},onMouseUp:u,children:"A"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(d)},onMouseUp:u,colorScheme:"blue",children:"A#"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(f)},onMouseUp:u,children:"B"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(p)},onMouseUp:u,children:"C"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(O)},onMouseUp:u,colorScheme:"blue",children:"C#"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(m)},onMouseUp:u,children:"D"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(S)},onMouseUp:u,colorScheme:"blue",children:"D#"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(_)},onMouseUp:u,children:"E"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(T)},onMouseUp:u,children:"F"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(b)},onMouseUp:u,colorScheme:"blue",children:"F#"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(v)},onMouseUp:u,children:"G"}),Object(i.jsx)(et.a,{onMouseDown:function(){return c(g)},onMouseUp:u,colorScheme:"blue",children:"G#"}),Object(i.jsx)(et.a,{colorScheme:"green",onClick:function(){return o((function(t){return t+1}))},children:"+"}),Object(i.jsx)(et.a,{colorScheme:"green",onClick:function(){return o((function(t){return t-1}))},children:"-"})]})};var it=function(){var t=n.useState(0),e=Object(a.a)(t,2),s=e[0],h=e[1],r=Q((function(){h((function(t){return t+1}))}));return Object(i.jsxs)(c.a,{children:[Object(i.jsx)(u.a,{}),Object(i.jsx)(l.a,{children:"Mini YM2612 Synth Demo"}),Object(i.jsx)(st,{synth:r}),Object(i.jsx)(tt,{context:r},s),Object(i.jsxs)(d.a,{children:["Based off of the ",Object(i.jsx)(f.a,{href:"https://github.com/apollolux/ym2612-js",children:"ym2612-js"})," library, and ",Object(i.jsx)(f.a,{href:"https://www.smspower.org/maxim/Documents/YM2612/",children:"this reference sheet."})]}),Object(i.jsx)(d.a,{children:"still extremely a WIP..."})]})};o.a.render(Object(i.jsx)(h.a.StrictMode,{children:Object(i.jsx)(it,{})}),document.getElementById("root"))}},[[78,1,2]]]);
//# sourceMappingURL=main.cd3b5e1a.chunk.js.map